<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Controle de Estoque - Login</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .tab-pane { transition: opacity 0.3s ease-in-out; }
    .tab-pane.fade { opacity: 0; }
    .tab-pane.show { opacity: 1; }
  </style>
</head>
<body class="bg-light">
  <div class="container">
    <div class="row justify-content-center mt-5">
      <div class="col-md-5">
        <div class="card shadow-lg border-0">
          <div class="card-header bg-primary text-white text-center py-4">
            <h3 class="mb-0">Controle de Estoque</h3>
          </div>
          <div class="card-body p-4">

            <!-- Nav tabs -->
            <ul class="nav nav-pills nav-fill mb-4" id="authTabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" id="login-tab" data-bs-toggle="tab" data-bs-target="#login" type="button">
                  Entrar
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="cadastro-tab" data-bs-toggle="tab" data-bs-target="#cadastro" type="button">
                  Cadastrar
                </button>
              </li>
            </ul>

            <!-- Tab panes -->
            <div class="tab-content" id="authTabContent">

              <!-- Login -->
              <div class="tab-pane fade show active" id="login" role="tabpanel">
                <form id="formLogin">
                  <div class="mb-3">
                    <label class="form-label">E-mail</label>
                    <input type="email" class="form-control form-control-lg" name="email" required>
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Senha</label>
                    <input type="password" class="form-control form-control-lg" name="senha" required>
                  </div>
                  <button type="submit" class="btn btn-primary btn-lg w-100">Entrar no Sistema</button>
                </form>
              </div>

              <!-- Cadastro -->
              <div class="tab-pane fade" id="cadastro" role="tabpanel">
                <form id="formCadastro">
                  <div class="mb-3">
                    <label class="form-label">Nome completo</label>
                    <input type="text" class="form-control form-control-lg" name="nome" required>
                  </div>
                  <div class="mb-3">
                    <label class="form-label">E-mail</label>
                    <input type="email" class="form-control form-control-lg" name="email" required>
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Senha</label>
                    <input type="password" class="form-control form-control-lg" name="senha" required>
                  </div>
                  <button type="submit" class="btn btn-success btn-lg w-100">Criar Conta</button>
                </form>
              </div>

            </div>

            <div id="msg" class="mt-4 text-center"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap 5 JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // Login
    document.getElementById('formLogin').onsubmit = async (e) => {
      e.preventDefault();
      const dados = Object.fromEntries(new FormData(e.target));
      
      const res = await fetch('api/login.php', {
        method: 'POST',
        credentials: 'include',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(dados)
      });
      
      const json = await res.json();
      const msgDiv = document.getElementById('msg');
      
      msgDiv.innerHTML = `<div class="alert alert-${res.ok ? 'success' : 'danger'} alert-dismissible fade show">
        <strong>${res.ok ? 'Sucesso!' : 'Erro:'}</strong> ${json.sucesso || json.erro}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>`;
      
      if (res.ok) {
        sessionStorage.setItem('nomeUsuario', json.nome || 'UsuÃ¡rio');
        setTimeout(() => location.href = 'dashboard.html', 1200);
      }
    };

    // Cadastro
    document.getElementById('formCadastro').onsubmit = async (e) => {
      e.preventDefault();
      const dados = Object.fromEntries(new FormData(e.target));
      
      const res = await fetch('api/register.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(dados)
      });
      
      const json = await res.json();
      const msgDiv = document.getElementById('msg');
      
      msgDiv.innerHTML = `<div class="alert alert-${res.ok ? 'success' : 'danger'} alert-dismissible fade show">
        <strong>${res.ok ? 'Pronto!' : 'Ops!'}</strong> ${json.sucesso || json.erro}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>`;

      if (res.ok) e.target.reset();
    };
  </script>
</body>
</html>